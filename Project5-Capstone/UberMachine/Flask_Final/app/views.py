from flask import render_template, flash, redirect
from app import app
from .forms import LoginForm
from googlemaps import Client
import requests
import pandas as pd
import numpy as np
import datetime
import sklearn.cross_validation as cv
from sklearn import linear_model
from sklearn.cross_validation import train_test_split
from sklearn import ensemble
from requests_forecast import Forecast
import operator

radius_complete = 0

#Reading in taxi/uber data from April
april = pd.read_csv('/Users/cholmes/Uber/april.csv')

#Adding in dummy variables for the day of week
april = pd.concat([april, pd.get_dummies(april['Weekday'])], axis=1)
del april['Weekday']

#Setting up a function to pull in the necessary variables to predict the uber conditions
def get_current_conditions():
    time = (datetime.datetime.now().hour * 6) + (datetime.datetime.now().minute/10)
    day = datetime.datetime.now().weekday() + 1
    if day == 6 or day == 7:
        weekend = 1
    else:
        weekend = 0

    # Using the dark skies API to get current temperture and if it's raining
    forecast = Forecast(apikey='7e616dba73de03ba9222e6ed09a3e88e', latitude=40.7246, longitude=-74.0021)
    current = forecast.get_currently()
    mean = current['temperature']
    rain = current['precipIntensity'] * 24

    conditions = [time, rain, mean, weekend]

    for j in range(1,8):
        if j == day:
            conditions.append(1)
        else:
            conditions.append(0)

    conditions  = np.array(conditions)
    conditions = conditions.reshape(1, -1)
    return conditions


#Fitting linear regression model
def linear_regression(neighborhoods):
    neighborhoods_regression = []
    for neighborhood in april.Neighborhood.unique():
        temp = april[april.Neighborhood == neighborhood]
        if len(temp) > 500:
            #Creating test set
            test = temp['Taxi_Order'] + temp['Uber_Order']

            #Deleting unnecessary columns
            del temp['Taxi_Order']
            del temp['Uber_Order']
            del temp['Min']
            del temp['Max']
            del temp['Neighborhood']
            del temp['Date']
            del temp['Uber_Share']
            del temp['Unnamed: 0']

            #Splittint out training and test sets
            x_train, x_test, y_train, y_test = train_test_split(temp,test, test_size=0.3, random_state=0)

            #Fitting the model + scoring
            ols = linear_model.LinearRegression()
            ols.fit(x_train, y_train)

            neighborhoods_regression[neighborhood] = int(ols.predict(get_current_conditions()))
    return neighborhoods_regression

def trees(neighborhoods):
    neighborhoods_trees = {}
    for neighborhood in neighborhoods:
        temp = april[april.Neighborhood == neighborhood]
        if len(temp) > 500:
            test = temp['Taxi_Order'] + temp['Uber_Order']

            #Deleting unnecessary columns
            del temp['Taxi_Order']
            del temp['Uber_Order']
            del temp['Min']
            del temp['Max']
            del temp['Neighborhood']
            del temp['Date']
            del temp['Uber_Share']
            del temp['Unnamed: 0']

            #Splittint out training and test sets
            x_train, x_test, y_train, y_test = train_test_split(temp,test, test_size=0.3, random_state=0)

            np.random.seed(1)
            randomForest = ensemble.RandomForestClassifier()
            randomForest.fit(x_train, y_train) # fit
            neighborhoods_trees[neighborhood] = (int(randomForest.predict(get_current_conditions())))
    return neighborhoods_trees


#This function determines the neighborhoods that are within a given distance
all_neighborhoods = {'Financial District': [40.7074909, -74.0112764], 'Williamsburg': [40.7081156, -73.9570696], 'South Bronx': [40.81767000000001, -73.91842609999999], 'Westerleigh-Castleton': [40.6342976, -74.1202417], 'Ridgewood': [40.7043986, -73.9018292], 'Huguenot': [41.4178712, -74.63099489999999], 'Clearview': [40.7804859, -73.7977928], 'Williams Bridge': [40.8780352, -73.8710014], 'Cobble Hill': [40.686536, -73.9962255], 'Inwood': [40.6220487, -73.74679890000002], 'Rossville': [40.5509808, -74.2032581], 'Harlem': [40.8115504, -73.9464769], 'Auburndale': [40.75411500000001, -73.7860276], 'Gramercy': [40.7376885, -73.98193619999999], 'Chelsea': [40.7465004, -74.00137370000002], 'Todt Hill': [40.6014342, -74.103441], 'University Heights': [40.85958610000001, -73.9109977], 'Greenwood': [42.13507, -77.6483236], 'Woodhaven-Richmond Hill': [40.6012236, -74.10949459999999], 'Park Slope': [40.6681038, -73.9805817], 'Chinatown': [40.7157509, -73.9970307], 'Bloomfield-Chelsea-Travis': [40.593718, -74.1662715], 'Corona': [40.7449859, -73.8642613], 'West Village': [40.735781, -74.0035709], 'Sunny Side': [40.7432759, -73.9196324], 'Soho': [40.723301, -74.0029883], 'Dyker Heights': [40.6187181, -74.0153231], 'Upper West Side': [40.7870106, -73.9753676], 'Queens Village': [40.7282239, -73.7948516], 'Bay Ridge': [40.6261638, -74.03294989999999], 'Wakefield-Williamsbridge': [40.8626913, -73.8578916], 'Jamaica': [40.702677, -73.7889689], "Prince's Bay": [40.5232804, -74.20032309999999], 'Bedford Park': [40.8700999, -73.8856912], 'East Village': [40.7264773, -73.98153370000001], 'Hunts Point': [40.8120246, -73.8801301], 'Gravesend-Sheepshead Bay': [40.5976048, -73.96513829999999], 'South Beach': [40.58290239999999, -74.0738631], 'Lower East Side': [40.715033, -73.9842724], 'Mapleton-Flatlands': [40.6193264, -73.9382998], 'Baychester': [40.8693862, -73.83308439999999], 'Upper East Side': [40.7735649, -73.9565551], 'Mariners Harbor': [40.6336287, -74.156292], 'Woodlawn': [42.797778, -78.8469439], 'Central Park': [40.7711329, -73.97418739999999], 'Woodside': [40.7512123, -73.90364869999999], 'Greenwich Village': [40.7335719, -74.0027418], 'Forest Hills': [40.718106, -73.8448469], 'Middle Village': [40.717372, -73.87425], 'Woodrow': [40.5394173, -74.19151769999999], 'Downtown': [40.7230084, -74.00063279999999], 'Morris Heights': [40.8515872, -73.9154069], 'Steinway': [40.7745459, -73.9037477], 'Rosebank': [40.6131912, -74.0726044], 'Utopia': [41.0988022, -74.1132145], 'Boerum Hill': [40.6848689, -73.9844722], 'Fort Green': [40.6920638, -73.97418739999999], 'Brownsville': [40.66308, -73.9095279], 'Bushwick': [40.6944282, -73.92128579999999], 'Eltingville': [40.5394463, -74.156292], 'Clinton': [43.0484029, -75.3785034], 'City Island': [40.8468202, -73.7874983], 'Midland Beach': [40.57149, -74.0931627], 'Borough Park': [40.6323009, -73.9888797], 'Parkchester': [40.8382522, -73.8566087], 'Astoria-Long Island City': [40.764202, -73.9150178], 'Garment District': [40.7547072, -73.9916342], 'Morningside Heights': [40.8089564, -73.96243270000001], 'Richmond': [40.5605312, -74.1474846], 'Flushing': [40.7674987, -73.833079], 'Unionport': [40.82754740000001, -73.8507279], 'East Harlem': [40.7957399, -73.93892129999999], 'Mott Haven': [40.8091068, -73.9228881], 'Washington Heights': [40.8417082, -73.9393554], 'Carroll Gardens': [40.6795331, -73.9991637], 'Tottenville': [40.5083408, -74.23554039999999], 'Flatbush': [40.6409217, -73.96243270000001], 'Laurelton': [40.6740861, -73.74484369999999], 'Canarsie': [40.6402325, -73.9060579], 'Tribeca': [40.7162692, -74.0086323], 'The Rockaways': [40.592658, -73.7977928], 'High Bridge': [40.8384699, -73.9271644], 'Midtown': [40.7549309, -73.9840195], 'Saintalbans': [40.6894086, -73.7654367], 'Queensboro Hill': [40.7553867, -73.951104], 'Tremont': [40.8447416, -73.8933596], 'Bensonhurst': [40.6112691, -73.9976946], 'Carnegie Hill': [40.7844653, -73.9550857], 'Douglastown-Little Neck': [40.7612957, -73.7330753], 'Murray Hill': [40.7478792, -73.9756567], 'Annandale': [42.0218762, -73.9095279], 'East Brooklyn': [40.6781784, -73.9441579], 'Nkew Gardens': [40.705695, -73.8272029], 'Oakwood': [40.5584751, -74.11518699999999], 'Battery Park': [40.7032775, -74.0170279], 'Springfield Gardens': [40.6626441, -73.7683784], 'Hamilton Heights': [40.8259597, -73.9496079], 'Charlestown-Richmond Valley': [42.3782065, -71.0602131], 'Great Kills': [40.5543273, -74.156292], 'Jackson Heights': [40.7556818, -73.8830701], 'Bedford-Stuyvesant': [40.6872176, -73.9417735], 'Morris Park': [40.8522006, -73.8507279], 'Sunset Park': [40.645532, -74.0123851], 'Country Club': [40.8430539, -73.8213213], 'Maspeth': [40.7294018, -73.9065883], 'Throggs Neck': [40.818399, -73.8213213], 'North Sutton Area': [40.7580204, -73.96016689999999], 'Soundview': [40.8251411, -73.86836970000002], 'Glendale': [40.698994, -73.8804427], 'Little Italy': [40.7191413, -73.9973273], 'Riverdale': [40.8940853, -73.9109977], 'Fordham': [40.8614705, -73.8905444], 'Eastchester': [40.95956049999999, -73.8095574], 'Clifton': [43.052284, -77.81472939999999], 'Yorkville': [43.1128475, -75.2709991], 'Kings Bridge': [40.8787108, -73.9051362], 'Spuyten Duyvil': [40.88116369999999, -73.9154069], 'New Brighton': [40.6404369, -74.090226]}
def get_neighborhoods(current_location, radius):    
    available_neighborhoods = {}
    for neighborhood in all_neighborhoods:
        #Turning latitude/longitude into miles. Since it's limited to NYC, this is possible because lat/long remain the same. If we were to expand this, we'd need to adjust this.

        latitude_change =  (all_neighborhoods[neighborhood][0] - current_location[0]) * 69
        longitude_change = (all_neighborhoods[neighborhood][1] - current_location[1]) * 53
        distance = ((latitude_change)**2 + (longitude_change)**2)**.5

        if distance < radius:
            available_neighborhoods[neighborhood] = all_neighborhoods[neighborhood]
    return available_neighborhoods


#Using this ny_stations from 9-14 to made the app run quickly. In the future, we can uncomment this to keep prices and locations more up to date.
ny_stations = {(40.653134, -73.88615399999999): ['1121 Pennsylvania Ave ', 2.33], (40.8684078, -73.8335974): ['1945 Bartow Ave ', 2.35], (40.64333420000001, -73.969481): ['571 Coney Island Ave ', 2.35], (40.6668331, -73.7579775): ['185-25 N Conduit Ave ', 2.79], (40.82232750000001, -73.8854001): ['1360 Bruckner Blvd ', 2.39], (40.633356, -73.8899296): ['9612 Seaview Ave ', 2.48], (40.637804, -73.910252): ['8401 Flatlands  ', 2.23], (40.8149924, -73.8972137): ['766 Southern Blvd ', 2.33], (40.823322, -73.867682): ['902 Soundview Ave ', 2.39], (40.78924920000001, -73.9482273): ['1599 Lexington Ave ', 2.35], (40.6944542, -73.9834664): ['185 Flatbush Ave Ext ', 3.39], (40.8669152, -73.9226317): ['4880 Broadway ', 2.33], (40.86792, -73.834304): ['1930 Bartow Ave ', 2.35], (40.675265, -73.865689): ['640 S Conduit Blvd ', 2.17], (40.8475232, -73.900975): ['1888 Webster Ave ', 2.31], (40.8183633, -73.8090364): ['4147 Throggs Neck Expy ', 2.39], (40.8952833, -73.8607612): ['4220 Bronx Blvd ', 2.25], (40.700933, -73.962526): ['677 Kent Ave ', 2.49], (40.8360308, -73.8900646): ['1624 Boston Rd ', 2.29], (40.7560109, -73.9977229): ['466 10th Ave ', 2.85], (40.8413764, -73.86430399999999): ['1881 E Tremont Ave ', 2.33], (40.8300535, -73.9408089): ['89 St Nicholas Pl ', 2.27], (40.7570074, -73.8701573): ['98-02 Northern Blvd ', 2.39], (40.6003433, -73.9610312): ['2317 Coney Island Ave ', 2.35], (40.648502, -73.97179899999999): ['378 Coney Island Ave ', 2.35], (40.79567309999999, -73.97358559999999): ['303 W 96th St ', 2.79], (40.581618, -73.83724699999999): ['115-05 Beach Channel Dr ', 2.41], (40.635706, -74.022654): ['6737 4th Ave ', 2.45], (40.78121, -73.9155959): ['21-02 21st Ave ', 2.31], (40.8209479, -73.93744079999999): ['120-128 W 145th St ', 2.31], (40.8355284, -73.8703242): ['1730 Cross Bronx Expy ', 2.45], (40.8803384, -73.90981959999999): ['3010 Riverdale Ave ', 2.29], (40.866193, -73.91799999999999): ['3936 10th Ave ', 2.35], (40.694226, -73.828439): ['118-19 Atlantic  ', 2.33], (40.5829369, -73.98594949999999): ['2955 Cropsey Ave ', 2.33], (40.6779748, -73.872067): ['463 N Conduit Blvd ', 2.19], (40.6975028, -73.93283939999999): ['1193 Myrtle Ave ', 2.17], (40.7141682, -73.9296439): ['1188 Metropolitan Ave ', 2.74], (40.7044137, -73.82574629999999): ['125-24 Metropolitan Ave ', 2.39], (40.7981227, -73.9336919): ['2326 1st Ave ', 2.39], (40.6349529, -73.9678241): ['914 Coney Island Ave ', 2.39], (40.6409942, -73.99375909999999): ['4310 Fort Hamilton Pkwy ', 2.43], (40.832676, -73.8984665): ['1365 Boston Rd ', 2.33], (40.693624, -73.8131192): ['134-35 101st Ave ', 2.31], (40.6079865, -73.9249827): ['3902 Ave U ', 2.35], (40.6115497, -73.9250857): ['2400 Flatbush Ave ', 2.23], (40.8054492, -73.9345312): ['4643 Third Ave ', 2.33], (40.644765, -73.9106895): ['971 Remsen Ave  ', 2.19], (40.5905201, -73.97449619999999): ['2965 86th St ', 2.35], (40.8950776, -73.8814261): ['70 Major Deegan Expy ', 2.59], (40.8742555, -73.8736078): ['3210 Webster Ave ', 2.25], (40.6770403, -73.8878228): ['2880 Atlantic Ave ', 2.19], (40.7044044, -73.8768227): ['73-13 Cooper  ', 2.23], (40.832952, -73.9452483): ['3740 Broadway ', 2.71], (40.62748, -73.96531499999999): ['1249 Coney Island Ave ', 2.39], (40.6805769, -73.9032959): ['1610 Bushwick Ave ', 2.25], (40.7036606, -73.822301): ['130-14 Hillside Ave ', 2.39], (40.69043629999999, -73.8411254): ['10409 Atlantic Ave ', 2.39], (40.841997, -73.8437426): ['3305 E Tremont Ave ', 2.31], (40.7157378, -74.00175399999999): ['392 Leonard St ', 2.19], (40.8781009, -73.8676428): ['641 E Gun Hill Rd ', 2.35], (40.8232518, -73.8827744): ['1419 Bruckner Blvd ', 2.39], (40.899413, -73.857542): ['610 Nereid Ave ', 2.25], (40.839961, -73.871377): ['1243 East Tremont Ave ', 2.29], (40.8054638, -73.911329): ['281 Bruckner Blvd ', 2.37], (40.7060173, -73.87672479999999): ['70-21 73rd Place ', 2.23], (40.6643178, -73.9487475): ['415 Empire Blvd ', 2.59], (40.6214622, -73.91701979999999): ['2317 Ralph Ave ', 2.39], (40.714051, -73.85903420000001): ['75-41 Yellowstone Blvd ', 2.33], (40.6449136, -74.0209923): ['5701 2nd Ave ', 2.39], (40.6989486, -73.9570403): ['732 Bedford Ave ', 2.19], (40.6517084, -74.0066484): ['4001 4th Ave ', 2.35], (40.6786468, -73.9444527): ['1381 Atlantic Ave ', 2.25], (40.8421141, -73.9226389): ['1413 Edward L Grant Hwy ', 2.33], (40.8660657, -73.9284749): ['242 Dyckman St ', 2.33], (40.677093, -74.0025996): ['260 Hamilton Ave ', 2.29], (40.622424, -73.937465): ['3827 Kings Hwy ', 2.24], (40.634004, -74.014325): ['6423 7th Ave ', 2.35], (40.82636, -73.8616419): ['1865 Bruckner Blvd ', 2.39], (40.601746, -73.935508): ['3095 Ave U ', 2.25], (40.6478575, -73.9151457): ['8913 Ditmas Ave ', 2.19], (40.5820781, -73.8374066): ['115-02 Beach Channel Dr ', 2.49], (40.6339611, -73.89024669999999): ['2000 Rockaway Pkwy  ', 2.49], (40.6420737, -73.9694528): ['619 Coney Island Ave ', 2.35], (40.6311111, -73.919748): ['5808 Flatlands Ave ', 2.23], (40.8646918, -73.83574349999999): ['1738 Gun Hill Rd ', 2.29], (40.6449872, -73.9872557): ['3501 Fort Hamilton Pkwy ', 2.33], (40.753235, -74.0044655): ['309 11th Ave ', 3.39], (40.6771546, -73.8251021): ['113-21 Rockaway Blvd ', 2.43], (40.863071, -73.920256): ['265 Nagle Ave ', 2.35], (40.6885654, -73.8757269): ['1 Euclid Ave ', 2.23], (40.63492189999999, -73.92835500000001): ['5001 Kings Hwy  ', 2.29], (40.755077, -73.891123): ['75-15 Northern Blvd ', 2.25], (40.8139759, -73.9405477): ['82 135th  ', 2.29], (40.845929, -73.902332): ['1805 Webster Ave ', 2.47], (40.6932408, -73.95570909999999): ['895 Bedford Ave ', 2.25], (40.7390385, -74.0035307): ['51-63 8th Ave ', 2.83], (40.6749136, -74.00010429999999): ['327 Hamilton Ave ', 2.35], (40.7385957, -73.84690220000002): ['107-02 Grand Central Pkwy E ', 2.53], (40.847491, -73.91217569999999): ['1740 Jerome Ave ', 2.33], (40.878277, -73.885915): ['3276 Jerome Ave ', 2.49], (40.746424, -73.89322): ['72-02 Roosevelt Ave ', 2.59], (40.865095, -73.8494947): ['1280 Allerton Ave ', 2.33], (40.7638954, -73.8811006): ['88-20 Astoria Blvd ', 2.33], (40.836325, -73.8383084): ['1320 Hutchinson River Pkwy N ', 3.59], (40.7217965, -73.77960259999999): ['196-03 Grand Central Pkwy ', 2.59], (40.65386000000001, -73.921615): ['484-500 Remsen Ave ', 2.23], (40.764625, -73.8866989): ['82-06 Astoria Blvd ', 2.39], (40.5962271, -73.9849114): ['2620 86th St ', 2.29], (40.83252, -73.828396): ['3424 E Tremont Ave ', 2.49], (40.80309099999999, -73.933731): ['255 E 125th St ', 2.33], (40.615831, -73.913862): ['6201  Ave U ', 2.35], (40.7334578, -73.95250279999999): ['321 McGuiness Blvd ', 2.15], (40.6367574, -73.968453): ['852 Coney Island Ave ', 2.35], (40.6821043, -73.90554019999999): ['1532 Bushwick Ave ', 2.29], (40.75766309999999, -73.8994958): ['31-02 68th St ', 2.25], (40.634034, -73.915002): ['7702 Flatlands Ave ', 2.27], (40.6062788, -73.9866345): ['125 Kings Hwy ', 2.39], (40.7602972, -73.86185119999999): ['107-10 Astoria Blvd ', 2.33], (40.6685943, -73.92158959999999): ['1412 Eastern Pkwy ', 2.23], (40.6791923, -73.953535): ['1143 Atlantic Ave ', 2.19], (40.7055595, -73.9269219): ['1127 Flushing Ave ', 2.17], (40.8107211, -73.9541326): ['117 Morningside Ave ', 2.43], (40.8564753, -73.86886369999999): ['600 South Pelham Pkwy ', 2.29], (40.70223250000001, -73.8797695): ['71-05 Myrtle Ave ', 2.29], (40.8811572, -73.8383582): ['3804 Boston Rd ', 2.35], (40.8451152, -73.902106): ['1752 Webster Ave ', 2.31], (40.8773641, -73.9034879): ['3031 Bailey Ave ', 2.39], (40.62605509999999, -73.9273711): ['1881 Utica Ave ', 2.23], (40.6943741, -73.8279994): ['119-01 Atlantic Ave ', 2.33], (40.6214204, -74.0204686): ['8202 7th Ave ', 2.39], (40.81934529999999, -73.9293789): ['99 E 149th St ', 2.33], (40.6743245, -74.0006938): ['354 Hamilton Ave ', 2.31], (40.74699409999999, -73.97754599999999): ['538 3rd Ave ', 2.56], (40.58577289999999, -73.822502): ['100-17 Beach Channel Dr  ', 2.29], (40.854222, -73.85486999999999): ['2007 Williamsbridge Rd ', 2.35], (40.7230268, -73.9388403): ['546 Morgan Ave ', 2.29], (40.85211100000001, -73.868223): ['2090 Bronxdale Ave ', 2.59], (40.82859, -73.882542): ['1441 Westchester Ave ', 2.35], (40.862948, -73.86612): ['2475 Boston Rd ', 2.31], (40.8347547, -73.829387): ['3355 E Tremont Ave ', 2.29], (40.8217525, -73.89842879999999): ['917 Westchester Ave ', 2.39], (40.7049582, -73.94986879999999): ['152 Union Ave ', 2.29], (40.7148091, -73.85940219999999): ['68-27 Woodhaven Blvd ', 2.29], (40.6573468, -73.8922719): ['1868 Linden Blvd ', 2.39], (40.6103683, -73.984635): ['7023 Bay Pkwy ', 2.43], (40.8273126, -73.8717925): ['1106 Metcalf Ave ', 2.49], (40.5959972, -73.9607534): ['2489 Coney Island Ave ', 2.39], (40.682484, -73.806341): ['114-02 Van Wyck Expy ', 2.33], (40.6457334, -73.9125151): ['914 Remsen Ave  ', 2.19], (40.6476477, -73.9795923): ['3132 Fort Hamilton Pkwy ', 2.39], (40.6771777, -73.9220895): ['1885 Atlantic Ave ', 2.19], (40.76313, -73.87709): ['92-10 Astoria Blvd ', 2.35], (40.6519663, -73.9088151): ['9719 Ditmas Ave ', 2.25], (40.5923639, -73.9400381): ['3755 Nostrand Ave ', 2.29], (40.6342212, -74.0147595): ['6418 7th Ave ', 2.45], (40.6763657, -73.8899267): ['2816 Atlantic Ave ', 2.19], (40.6832172, -73.867539): ['3513 Atlantic Ave ', 2.45], (40.8801699, -73.9099561): ['317 W 230th St ', 2.27], (40.640312, -74.01950099999999): ['6102 4th Ave ', 2.45], (40.6960055, -73.90548559999999): ['1379 Halsey St ', 2.29], (40.6794587, -73.9006413): ['644 Bushwick Ave ', 2.23], (40.6942002, -73.9614551): ['569 Myrtle Ave ', 2.57], (40.6383198, -74.020658): ['6401 4th Ave ', 2.39], (40.8556767, -73.85511369999999): ['2100 Williamsbridge Rd ', 2.55], (40.8773294, -73.8677119): ['688 E Gun Hill Rd ', 2.47], (40.77311090000001, -73.95172370000002): ['401 E 80th St ', 2.29], (40.6185398, -74.0296877): ['9111 4th Ave ', 2.29], (40.6127518, -73.99608239999999): ['7519 18th Ave ', 2.27], (40.7261022, -73.8977474): ['6615 Borden Ave ', 2.27], (40.8884793, -73.84258659999999): ['1220 E 233rd St ', 2.33], (40.613717, -73.99606): ['1781 Bay Ridge Pkwy ', 2.29], (40.80473, -73.9233074): ['100-102 Bruckner Blvd ', 2.59], (40.8961598, -73.867341): ['285 E 233rd St ', 2.25], (40.87325999999999, -73.854228): ['1128 E Gun Hill Rd ', 2.33], (40.625706, -74.0014252): ['1302 65th  ', 2.27], (40.6847894, -73.85951969999999): ['81-02 Atlantic Ave ', 2.45], (40.679582, -73.880067): ['3123 Atlantic Ave ', 2.23], (40.7968414, -73.9346636): ['2276 1st Ave ', 2.39], (40.592636, -73.9610149): ['2624 Coney Island  ', 2.35], (40.7303, -73.948093): ['278 Greenpoint Ave ', 2.11], (40.6667599, -73.752639): ['224-01 N Conduit Ave ', 2.39], (40.8232109, -73.8786349): ['1500 Bruckner Blvd ', 2.45], (40.8643137, -73.9174139): ['401 W 207th St ', 2.35], (40.849986, -73.7875883): ['400-410 City Island Ave ', 2.39], (40.5927721, -73.9928824): ['2495 Cropsey Ave ', 2.39], (40.63276200000001, -73.966539): ['1041 Coney Island Ave ', 2.39], (40.884662, -73.901245): ['5805 Broadway ', 2.43], (40.8653134, -73.8591788): ['950 Allerton Ave ', 2.35], (40.8949154, -73.8825221): ['71 Major Deegan Expwy ', 2.59], (40.7682469, -73.9696664): ['842 5th Ave ', 2.29], (40.5876666, -73.94953559999999): ['3010 Ocean Ave ', 2.35], (40.7985238, -73.9517339): ['10 Malcolm X Blvd ', 2.13], (40.7618167, -73.8973204): ['2565 Brooklyn Queens Expressway East ', 2.49], (40.6439825, -73.9704702): ['548 Coney Island Ave ', 2.43], (40.7308866, -73.95132749999999): ['256 McGuinness Blvd ', 2.29], (40.7678148, -73.90100369999999): ['49-05 Astoria Blvd N ', 2.39], (40.6964913, -73.9562977): ['801 Bedford Ave ', 2.25], (40.8208861, -73.9382754): ['150 W 145th St ', 2.61], (40.7553735, -73.8903851): ['76-11 Northern Blvd ', 2.53], (40.7588621, -73.93748049999999): ['36-37 21st St ', 2.45], (40.6478464, -73.9147436): ['8914 Ditmas Ave ', 2.39], (40.8665929, -73.8385328): ['1665 Bartow Ave ', 2.29], (40.6144318, -73.92773749999999): ['2285 Flatbush Ave ', 2.23], (40.77942669999999, -73.9065141): ['2001 31st St ', 2.39], (40.6216412, -73.9749966): ['5025 Bay Pkwy ', 2.39], (40.7347683, -73.98609379999999): ['169 3rd Ave ', 2.86], (40.73019960000001, -73.95165899999999): ['210 Greenpoint Ave ', 2.17], (40.61690600000001, -73.9999153): ['7310 New Utrecht Ave ', 2.39], (40.8594744, -73.8673836): ['2290 Boston Rd ', 2.29], (40.7632871, -73.97314829999999): ['745 Fifth Ave ', 2.35], (40.752691, -73.910709): ['50-92 Northern Blvd ', 2.35], (40.6795859, -73.95813629999999): ['1064 Atlantic Ave ', 2.29], (40.6443979, -73.910934): ['972 Remsen Ave ', 2.33], (40.6268712, -73.9416617): ['1760 Flatbush Ave ', 2.27], (40.7000701, -73.9613392): ['713 Kent Ave ', 2.49], (40.8486256, -73.8310882): ['3065 Westchester Ave ', 2.33], (40.8409755, -73.8426226): ['91 Westchester Sq ', 2.33], (40.8351536, -73.9242433): ['1133 Jerome Ave ', 2.29], (40.6773788, -73.9278779): ['1781 Atlantic Ave ', 2.19], (40.582448, -73.834698): ['112-01 Beach Channel Dr ', 2.29], (40.6547991, -73.931124): ['756 Utica  ', 2.29], (40.8075621, -73.9293617): ['119 Bruckner Blvd ', 2.27], (40.6765886, -73.921497): ['1998 Atlantic Ave ', 2.19], (40.8492614, -73.91647689999999): ['1764 University Ave ', 2.33], (40.8515161, -73.8948066): ['495 E 180th St ', 2.29], (40.7286351, -73.9502249): ['176 McGuiness Blvd ', 2.13], (40.8448765, -73.84624819999999): ['1500 Williamsbridge Rd ', 2.33], (40.582987, -73.835201): ['112-10 Beach Channel Dr ', 2.33], (40.622043, -73.987684): ['6002 18th Ave ', 2.29], (40.8652945, -73.86202089999999): ['824 Allerton Ave ', 2.33], (40.6802425, -73.958591): ['1013 Atlantic  ', 2.29], (40.6560743, -73.94748799999999): ['720 New York Ave ', 2.39], (40.677858, -73.98317999999999): ['204-222 Fourth Ave ', 2.25], (40.8174926, -73.956356): ['3260 Broadway  ', 2.39], (40.5968616, -73.9505824): ['2001 Gravesend Neck Rd ', 2.45], (40.836564, -73.870655): ['1719 Cross Bronx Expy N ', 2.43], (40.7624381, -73.9570024): ['805 65th St ', 2.39], (40.8957637, -73.87643969999999): ['1 East 233rd St ', 2.35], (40.6770742, -73.8968713): ['2642 Fulton St ', 2.25], (40.7132879, -73.9776201): ['1049 Grand St ', 2.39], (40.6772339, -73.8986783): ['32 Jamaica Ave ', 2.29], (40.6881907, -73.8756468): ['784 Jamaica Ave ', 2.27], (40.6795807, -73.8779243): ['3170 Atlantic Ave ', 2.17], (40.7173557, -73.81745169999999): ['141-50 Union Tpke  ', 2.33], (40.7898331, -73.9405791): ['348 E 106th St ', 2.35], (40.8075298, -73.9376199): ['1890 Park Ave ', 2.33], (40.6011989, -73.9344783): ['2228 Gerritsen Ave ', 2.25], (40.67791649999999, -73.9438971): ['1450 Atlantic Ave ', 2.21], (40.845049, -73.93858999999999): ['4116 Broadway ', 2.43], (40.657191, -74.000889): ['833 4th Ave ', 2.27], (40.8599194, -73.9026122): [' 2350 Jerome Ave ', 2.33], (40.76486999999999, -73.883909): ['85-05 Astoria Blvd ', 2.35], (40.6472259, -73.98086049999999): ['28 Caton  ', 2.33], (40.6273057, -73.96591459999999): ['1248 Coney Island Ave ', 2.39], (40.751147, -73.974256): ['668 3rd Ave ', 2.25], (40.882357, -73.8265322): ['2280 Tillotson Ave ', 2.27], (40.5803553, -73.9858725): ['3072 Cropsey Ave ', 2.25], (40.89582600000001, -73.86362): ['4201 Webster Ave ', 2.35], (40.6803333, -73.8406083): ['98-21 Rockaway Blvd ', 2.29], (40.8795545, -73.83722569999999): ['3400-08 Baychester Ave ', 2.29], (40.6483375, -73.90566319999999): ['9702 Foster Ave  ', 2.37], (40.7027649, -73.8548687): ['9005 Myrtle Ave ', 2.45], (40.6454988, -73.98536849999999): ['3437 Ft Hamilton Pkwy ', 2.31], (40.8713659, -73.8639902): ['780 Burke Ave ', 2.39], (40.7617081, -73.8681658): ['101-06 Astoria Blvd ', 2.33], (40.6730189, -73.87168): ['1249 Sutter Ave ', 2.25], (40.6478184, -73.97160389999999): ['418 Coney Island Ave ', 2.45], (40.6395011, -73.95440839999999): ['1267 Flatbush Ave   ', 2.24], (40.7076887, -73.950845): ['239 Union Ave ', 2.39], (40.6807235, -73.9617289): ['941 Atlantic Ave ', 2.29], (40.856941, -73.88163999999999): ['730 E Fordham Rd ', 2.53], (40.639255, -74.0230155): ['301 65th  ', 2.29], (40.71460260000001, -73.9422105): ['2 Bushwick Ave ', 2.25], (40.60898299999999, -73.973787): ['2516 65th St ', 2.37], (40.6730638, -73.9988774): ['375 Hamilton Ave ', 2.49], (40.5925173, -73.90819139999999): ['6000 Shore Pkwy ', 2.59], (40.8680518, -73.85885569999999): ['2918 Boston Rd ', 2.29], (40.8615796, -73.91241029999999): ['296 W Fordham Rd ', 2.39], (40.8500841, -73.8641664): ['1982 Bronxdale Ave ', 2.39], (40.80525, -73.9347313): ['4058 3rd Ave ', 2.33], (40.884991, -73.826518): ['3500 Conner St ', 2.35], (40.6303489, -73.94543709999999): ['1640 Flatbush Ave ', 2.29], (40.88549330000001, -73.8280461): ['4090 Boston Rd ', 2.29], (40.7797904, -73.9443915): ['579 92nd St ', 2.45], (40.826602, -73.859073): ['1915 Bruckner Blvd ', 2.49], (40.6801719, -73.8392721): ['100-07 Rockaway Blvd ', 2.29], (40.8349887, -73.830105): ['3333 E Tremont Ave ', 2.33], (40.6765117, -73.9093378): ['2111 Atlantic Ave ', 2.37], (40.6614537, -73.9610021): ['513 Flatbush Ave ', 2.29], (40.8138298, -73.9306617): ['115 E 138th St ', 2.45], (40.7016427, -73.93712099999999): ['864 Flushing Ave ', 2.43], (40.8367838, -73.92705959999999): ['1165 Ogden Ave ', 2.17], (40.8203004, -73.9266353): ['611 Grand Concourse ', 2.31], (40.8583781, -73.88552109999999): ['590 E Fordham Rd ', 2.27], (40.654226, -73.90715469999999): ['1022 Rockaway Ave ', 2.27], (40.8466909, -73.9019081): ['1845 Webster Ave ', 2.41], (40.8502094, -73.8371051): ['1325 Hutchinson River Pkwy S ', 3.59], (40.7663445, -73.9940505): ['718 11th Ave ', 3.99], (40.679269, -73.89942669999999): ['32 Highland Blvd ', 2.29], (40.6975358, -73.9693733): ['168 Flushing Ave ', 2.39], (40.8072502, -73.9238593): ['164 Willis Ave ', 2.69], (40.8218906, -73.9405752): ['232 W 145th St ', 2.27], (40.631525, -74.002456): ['1105 60th St ', 2.29], (40.8482409, -73.88360080000001): ['820 E 182nd St ', 2.33], (40.7415548, -73.9723541): ['FDR Dr  ', 2.89], (40.8392619, -73.9373512): ['2165 Amsterdam Ave ', 2.35], (40.62329039999999, -73.9276971): ['1982 Utica Ave ', 2.37], (40.8157268, -73.92831369999999): ['350 Grand Concourse ', 2.29], (40.7374927, -73.74182019999999): ['108-01 Grand Central Pkwy W  ', 2.53], (40.7699117, -73.9025442): ['4606 Ditmars Blvd ', 2.35], (40.6329769, -74.0125429): ['6418 8th Ave ', 2.39], (40.8691366, -73.9072685): ['2590 Bailey Ave ', 2.39], (40.6771699, -73.9300293): ['1802 Atlantic Ave ', 2.27], (40.83686549999999, -73.92161399999999): ['1237 Jerome Ave ', 2.33], (40.7343687, -73.98991269999999): ['164 4th Ave ', 2.29], (40.5943506, -73.93332509999999): ['2402 Knapp St ', 2.35], (40.608699, -74.0056984): ['1672 86th St ', 2.49], (40.6141179, -73.9633741): ['1780 Coney Island Ave ', 2.39], (40.80497099999999, -73.912306): ['250 Jackson Ave ', 2.31], (40.6771623, -73.93274389999999): ['1740 Atlantic Ave ', 2.23], (40.60637699999999, -73.987436): ['1626 Stillwell Ave ', 2.39], (40.8704356, -73.9147205): ['5080 Broadway ', 2.39], (40.8172955, -73.8934649): ['126 Bruckner Blvd ', 2.29], (40.6522291, -73.9223793): ['5824 Church Ave ', 2.19], (40.6122293, -74.0115112): ['1420 86th St ', 2.49], (40.90766929999999, -73.8968242): ['6571 Broadway ', 2.35], (40.6561408, -74.00201369999999): ['875 4th Ave ', 2.39], (40.5945081, -73.78942339999999): ['59-14 Beach Channel Dr ', 2.27], (40.88553599999999, -73.9000712): ['5832 Broadway ', 2.67], (40.71267410000001, -73.9051532): ['60-04 Metropolitan Ave ', 2.29], (40.7830906, -73.9452024): ['1855 1st Ave ', 2.33], (40.6368129, -73.936048): ['4210 Farragut Rd ', 2.31], (40.888745, -73.841551): ['1225 E 233rd St ', 2.49], (40.7206819, -73.944379): ['497 Meeker Ave ', 2.19], (40.6380468, -73.9793267): ['1 Cortelyou Rd ', 2.35], (40.7146911, -73.9415973): ['810 Metropolitan Ave ', 2.25], (40.7002436, -73.9475598): ['655 Flushing Ave ', 2.29], (40.870828, -73.877977): ['3079-3087 Webster Ave ', 2.45], (40.6528025, -73.8868997): ['1130 Pennsylvania  Ave ', 2.23], (40.679827, -73.877043): ['3196 Atlantic Ave ', 2.19], (40.6761461, -73.8679717): ['586 S Conduit Blvd ', 2.37], (40.6399524, -73.98302799999999): ['3715 14th Ave  ', 2.29], (40.6014868, -74.00478389999999): ['1907 Cropsey Ave ', 2.39], (40.6227826, -73.9865202): ['5818 18th Ave ', 2.35], (40.6634448, -73.9541796): ['250 Empire Blvd ', 2.29], (40.8414943, -73.9275881): ['1314 Sedgwick Ave ', 2.17], (40.7584157, -73.9688887): ['899 3rd Ave ', 2.29], (40.8703011, -73.87882119999999): ['3059 Webster Ave ', 2.51], (40.7624133, -73.9570207): ['802 65th St ', 2.29], (40.6587085, -73.891305): ['1935 Linden Blvd ', 2.35], (40.6141277, -73.9628424): ['1775 Coney Island Ave ', 2.35], (40.891866, -73.853347): ['836 East 233rd St ', 2.37], (40.6186288, -74.0208329): ['8521 7th Ave ', 2.29]}


@app.route('/')
@app.route('/index')
def index():

  class location():
    def __init__(self, json):
        data = json.json()['loc']
        self.lat = data[0:7]
        self.long = data[8:16]

    def get_current(self):
        return self.lat, self.long

  #Getting current location
  my_location = location(requests.get('http://ipinfo.io/json'))
  latlong = requests.get('https://maps.googleapis.com/maps/api/geocode/json?address=' + my_location.get_current()[0] + ',' + my_location.get_current()[1] + '&key=AIzaSyBOkcsB4FSHYoz6CorB32hOv9qUOWPfcvw')
  current_loc = latlong.json()['results'][0]['formatted_address']
  curlat = latlong.json()['results'][0]['geometry']['location']['lat']
  curlng = latlong.json()['results'][0]['geometry']['location']['lng']
  current_latlng = [curlat, curlng]


  returned_neighbor = trees(get_neighborhoods(current_latlng , int(radius_complete)))
  max_item = max(returned_neighbor.iteritems(), key=operator.itemgetter(1))[0]

  #Getting directions to best neighborhood
  c = Client(key='AIzaSyBOkcsB4FSHYoz6CorB32hOv9qUOWPfcvw')
  steps = c.directions(tuple(current_latlng), all_neighborhoods[max_item])[0]['legs'][0]['steps']
  instructions = []
  for d in steps:
    instructions.append(d['html_instructions'])


  #Getting directions from your current location to a new latitude/longitude
  user = {'current_location': current_loc, 'neighborhoods': max_item, 'directions': instructions} 

  return render_template('index.html',
                           title='Home',
                           user=user)


@app.route('/uber', methods=['GET', 'POST'])
def uber():
    form = LoginForm()
    if form.validate_on_submit():
        #Setting radius, gas, and restaurants globally to use for limiting neighborhoods
        global radius_complete
        radius_complete = form.openid.data
        global gas_complete
        gas_complete = form.gas.data
        global restaurants_complete
        restaurants_complete = form.restaurants.data 

        if form.gas.data == 1:
          return redirect('/gas')

        return redirect('/index')
    return render_template('uber.html',
                           title='Sign In',
                           form=form,
                           providers=app.config['OPENID_PROVIDERS'])

@app.route('/gas', methods=['GET', 'POST'])
def gas():
  class location():
    def __init__(self, json):
        data = json.json()['loc']
        self.lat = data[0:7]
        self.long = data[8:16]

    def get_current(self):
        return self.lat, self.long

  #Getting current location
  my_location = location(requests.get('http://ipinfo.io/json'))
  latlong = requests.get('https://maps.googleapis.com/maps/api/geocode/json?address=' + my_location.get_current()[0] + ',' + my_location.get_current()[1] + '&key=AIzaSyBOkcsB4FSHYoz6CorB32hOv9qUOWPfcvw')
  current_loc = latlong.json()['results'][0]['formatted_address']
  curlat = latlong.json()['results'][0]['geometry']['location']['lat']
  curlng = latlong.json()['results'][0]['geometry']['location']['lng']
  current_latlng = [curlat, curlng]

  #Finding the Nearest Gas Station
  ny_stations = {(40.653134, -73.88615399999999): ['1121 Pennsylvania Ave ', 2.33], (40.8684078, -73.8335974): ['1945 Bartow Ave ', 2.35], (40.64333420000001, -73.969481): ['571 Coney Island Ave ', 2.35], (40.6668331, -73.7579775): ['185-25 N Conduit Ave ', 2.79], (40.82232750000001, -73.8854001): ['1360 Bruckner Blvd ', 2.39], (40.633356, -73.8899296): ['9612 Seaview Ave ', 2.48], (40.637804, -73.910252): ['8401 Flatlands  ', 2.23], (40.8149924, -73.8972137): ['766 Southern Blvd ', 2.33], (40.823322, -73.867682): ['902 Soundview Ave ', 2.39], (40.78924920000001, -73.9482273): ['1599 Lexington Ave ', 2.35], (40.6944542, -73.9834664): ['185 Flatbush Ave Ext ', 3.39], (40.8669152, -73.9226317): ['4880 Broadway ', 2.33], (40.86792, -73.834304): ['1930 Bartow Ave ', 2.35], (40.675265, -73.865689): ['640 S Conduit Blvd ', 2.17], (40.8475232, -73.900975): ['1888 Webster Ave ', 2.31], (40.8183633, -73.8090364): ['4147 Throggs Neck Expy ', 2.39], (40.8952833, -73.8607612): ['4220 Bronx Blvd ', 2.25], (40.700933, -73.962526): ['677 Kent Ave ', 2.49], (40.8360308, -73.8900646): ['1624 Boston Rd ', 2.29], (40.7560109, -73.9977229): ['466 10th Ave ', 2.85], (40.8413764, -73.86430399999999): ['1881 E Tremont Ave ', 2.33], (40.8300535, -73.9408089): ['89 St Nicholas Pl ', 2.27], (40.7570074, -73.8701573): ['98-02 Northern Blvd ', 2.39], (40.6003433, -73.9610312): ['2317 Coney Island Ave ', 2.35], (40.648502, -73.97179899999999): ['378 Coney Island Ave ', 2.35], (40.79567309999999, -73.97358559999999): ['303 W 96th St ', 2.79], (40.581618, -73.83724699999999): ['115-05 Beach Channel Dr ', 2.41], (40.635706, -74.022654): ['6737 4th Ave ', 2.45], (40.78121, -73.9155959): ['21-02 21st Ave ', 2.31], (40.8209479, -73.93744079999999): ['120-128 W 145th St ', 2.31], (40.8355284, -73.8703242): ['1730 Cross Bronx Expy ', 2.45], (40.8803384, -73.90981959999999): ['3010 Riverdale Ave ', 2.29], (40.866193, -73.91799999999999): ['3936 10th Ave ', 2.35], (40.694226, -73.828439): ['118-19 Atlantic  ', 2.33], (40.5829369, -73.98594949999999): ['2955 Cropsey Ave ', 2.33], (40.6779748, -73.872067): ['463 N Conduit Blvd ', 2.19], (40.6975028, -73.93283939999999): ['1193 Myrtle Ave ', 2.17], (40.7141682, -73.9296439): ['1188 Metropolitan Ave ', 2.74], (40.7044137, -73.82574629999999): ['125-24 Metropolitan Ave ', 2.39], (40.7981227, -73.9336919): ['2326 1st Ave ', 2.39], (40.6349529, -73.9678241): ['914 Coney Island Ave ', 2.39], (40.6409942, -73.99375909999999): ['4310 Fort Hamilton Pkwy ', 2.43], (40.832676, -73.8984665): ['1365 Boston Rd ', 2.33], (40.693624, -73.8131192): ['134-35 101st Ave ', 2.31], (40.6079865, -73.9249827): ['3902 Ave U ', 2.35], (40.6115497, -73.9250857): ['2400 Flatbush Ave ', 2.23], (40.8054492, -73.9345312): ['4643 Third Ave ', 2.33], (40.644765, -73.9106895): ['971 Remsen Ave  ', 2.19], (40.5905201, -73.97449619999999): ['2965 86th St ', 2.35], (40.8950776, -73.8814261): ['70 Major Deegan Expy ', 2.59], (40.8742555, -73.8736078): ['3210 Webster Ave ', 2.25], (40.6770403, -73.8878228): ['2880 Atlantic Ave ', 2.19], (40.7044044, -73.8768227): ['73-13 Cooper  ', 2.23], (40.832952, -73.9452483): ['3740 Broadway ', 2.71], (40.62748, -73.96531499999999): ['1249 Coney Island Ave ', 2.39], (40.6805769, -73.9032959): ['1610 Bushwick Ave ', 2.25], (40.7036606, -73.822301): ['130-14 Hillside Ave ', 2.39], (40.69043629999999, -73.8411254): ['10409 Atlantic Ave ', 2.39], (40.841997, -73.8437426): ['3305 E Tremont Ave ', 2.31], (40.7157378, -74.00175399999999): ['392 Leonard St ', 2.19], (40.8781009, -73.8676428): ['641 E Gun Hill Rd ', 2.35], (40.8232518, -73.8827744): ['1419 Bruckner Blvd ', 2.39], (40.899413, -73.857542): ['610 Nereid Ave ', 2.25], (40.839961, -73.871377): ['1243 East Tremont Ave ', 2.29], (40.8054638, -73.911329): ['281 Bruckner Blvd ', 2.37], (40.7060173, -73.87672479999999): ['70-21 73rd Place ', 2.23], (40.6643178, -73.9487475): ['415 Empire Blvd ', 2.59], (40.6214622, -73.91701979999999): ['2317 Ralph Ave ', 2.39], (40.714051, -73.85903420000001): ['75-41 Yellowstone Blvd ', 2.33], (40.6449136, -74.0209923): ['5701 2nd Ave ', 2.39], (40.6989486, -73.9570403): ['732 Bedford Ave ', 2.19], (40.6517084, -74.0066484): ['4001 4th Ave ', 2.35], (40.6786468, -73.9444527): ['1381 Atlantic Ave ', 2.25], (40.8421141, -73.9226389): ['1413 Edward L Grant Hwy ', 2.33], (40.8660657, -73.9284749): ['242 Dyckman St ', 2.33], (40.677093, -74.0025996): ['260 Hamilton Ave ', 2.29], (40.622424, -73.937465): ['3827 Kings Hwy ', 2.24], (40.634004, -74.014325): ['6423 7th Ave ', 2.35], (40.82636, -73.8616419): ['1865 Bruckner Blvd ', 2.39], (40.601746, -73.935508): ['3095 Ave U ', 2.25], (40.6478575, -73.9151457): ['8913 Ditmas Ave ', 2.19], (40.5820781, -73.8374066): ['115-02 Beach Channel Dr ', 2.49], (40.6339611, -73.89024669999999): ['2000 Rockaway Pkwy  ', 2.49], (40.6420737, -73.9694528): ['619 Coney Island Ave ', 2.35], (40.6311111, -73.919748): ['5808 Flatlands Ave ', 2.23], (40.8646918, -73.83574349999999): ['1738 Gun Hill Rd ', 2.29], (40.6449872, -73.9872557): ['3501 Fort Hamilton Pkwy ', 2.33], (40.753235, -74.0044655): ['309 11th Ave ', 3.39], (40.6771546, -73.8251021): ['113-21 Rockaway Blvd ', 2.43], (40.863071, -73.920256): ['265 Nagle Ave ', 2.35], (40.6885654, -73.8757269): ['1 Euclid Ave ', 2.23], (40.63492189999999, -73.92835500000001): ['5001 Kings Hwy  ', 2.29], (40.755077, -73.891123): ['75-15 Northern Blvd ', 2.25], (40.8139759, -73.9405477): ['82 135th  ', 2.29], (40.845929, -73.902332): ['1805 Webster Ave ', 2.47], (40.6932408, -73.95570909999999): ['895 Bedford Ave ', 2.25], (40.7390385, -74.0035307): ['51-63 8th Ave ', 2.83], (40.6749136, -74.00010429999999): ['327 Hamilton Ave ', 2.35], (40.7385957, -73.84690220000002): ['107-02 Grand Central Pkwy E ', 2.53], (40.847491, -73.91217569999999): ['1740 Jerome Ave ', 2.33], (40.878277, -73.885915): ['3276 Jerome Ave ', 2.49], (40.746424, -73.89322): ['72-02 Roosevelt Ave ', 2.59], (40.865095, -73.8494947): ['1280 Allerton Ave ', 2.33], (40.7638954, -73.8811006): ['88-20 Astoria Blvd ', 2.33], (40.836325, -73.8383084): ['1320 Hutchinson River Pkwy N ', 3.59], (40.7217965, -73.77960259999999): ['196-03 Grand Central Pkwy ', 2.59], (40.65386000000001, -73.921615): ['484-500 Remsen Ave ', 2.23], (40.764625, -73.8866989): ['82-06 Astoria Blvd ', 2.39], (40.5962271, -73.9849114): ['2620 86th St ', 2.29], (40.83252, -73.828396): ['3424 E Tremont Ave ', 2.49], (40.80309099999999, -73.933731): ['255 E 125th St ', 2.33], (40.615831, -73.913862): ['6201  Ave U ', 2.35], (40.7334578, -73.95250279999999): ['321 McGuiness Blvd ', 2.15], (40.6367574, -73.968453): ['852 Coney Island Ave ', 2.35], (40.6821043, -73.90554019999999): ['1532 Bushwick Ave ', 2.29], (40.75766309999999, -73.8994958): ['31-02 68th St ', 2.25], (40.634034, -73.915002): ['7702 Flatlands Ave ', 2.27], (40.6062788, -73.9866345): ['125 Kings Hwy ', 2.39], (40.7602972, -73.86185119999999): ['107-10 Astoria Blvd ', 2.33], (40.6685943, -73.92158959999999): ['1412 Eastern Pkwy ', 2.23], (40.6791923, -73.953535): ['1143 Atlantic Ave ', 2.19], (40.7055595, -73.9269219): ['1127 Flushing Ave ', 2.17], (40.8107211, -73.9541326): ['117 Morningside Ave ', 2.43], (40.8564753, -73.86886369999999): ['600 South Pelham Pkwy ', 2.29], (40.70223250000001, -73.8797695): ['71-05 Myrtle Ave ', 2.29], (40.8811572, -73.8383582): ['3804 Boston Rd ', 2.35], (40.8451152, -73.902106): ['1752 Webster Ave ', 2.31], (40.8773641, -73.9034879): ['3031 Bailey Ave ', 2.39], (40.62605509999999, -73.9273711): ['1881 Utica Ave ', 2.23], (40.6943741, -73.8279994): ['119-01 Atlantic Ave ', 2.33], (40.6214204, -74.0204686): ['8202 7th Ave ', 2.39], (40.81934529999999, -73.9293789): ['99 E 149th St ', 2.33], (40.6743245, -74.0006938): ['354 Hamilton Ave ', 2.31], (40.74699409999999, -73.97754599999999): ['538 3rd Ave ', 2.56], (40.58577289999999, -73.822502): ['100-17 Beach Channel Dr  ', 2.29], (40.854222, -73.85486999999999): ['2007 Williamsbridge Rd ', 2.35], (40.7230268, -73.9388403): ['546 Morgan Ave ', 2.29], (40.85211100000001, -73.868223): ['2090 Bronxdale Ave ', 2.59], (40.82859, -73.882542): ['1441 Westchester Ave ', 2.35], (40.862948, -73.86612): ['2475 Boston Rd ', 2.31], (40.8347547, -73.829387): ['3355 E Tremont Ave ', 2.29], (40.8217525, -73.89842879999999): ['917 Westchester Ave ', 2.39], (40.7049582, -73.94986879999999): ['152 Union Ave ', 2.29], (40.7148091, -73.85940219999999): ['68-27 Woodhaven Blvd ', 2.29], (40.6573468, -73.8922719): ['1868 Linden Blvd ', 2.39], (40.6103683, -73.984635): ['7023 Bay Pkwy ', 2.43], (40.8273126, -73.8717925): ['1106 Metcalf Ave ', 2.49], (40.5959972, -73.9607534): ['2489 Coney Island Ave ', 2.39], (40.682484, -73.806341): ['114-02 Van Wyck Expy ', 2.33], (40.6457334, -73.9125151): ['914 Remsen Ave  ', 2.19], (40.6476477, -73.9795923): ['3132 Fort Hamilton Pkwy ', 2.39], (40.6771777, -73.9220895): ['1885 Atlantic Ave ', 2.19], (40.76313, -73.87709): ['92-10 Astoria Blvd ', 2.35], (40.6519663, -73.9088151): ['9719 Ditmas Ave ', 2.25], (40.5923639, -73.9400381): ['3755 Nostrand Ave ', 2.29], (40.6342212, -74.0147595): ['6418 7th Ave ', 2.45], (40.6763657, -73.8899267): ['2816 Atlantic Ave ', 2.19], (40.6832172, -73.867539): ['3513 Atlantic Ave ', 2.45], (40.8801699, -73.9099561): ['317 W 230th St ', 2.27], (40.640312, -74.01950099999999): ['6102 4th Ave ', 2.45], (40.6960055, -73.90548559999999): ['1379 Halsey St ', 2.29], (40.6794587, -73.9006413): ['644 Bushwick Ave ', 2.23], (40.6942002, -73.9614551): ['569 Myrtle Ave ', 2.57], (40.6383198, -74.020658): ['6401 4th Ave ', 2.39], (40.8556767, -73.85511369999999): ['2100 Williamsbridge Rd ', 2.55], (40.8773294, -73.8677119): ['688 E Gun Hill Rd ', 2.47], (40.77311090000001, -73.95172370000002): ['401 E 80th St ', 2.29], (40.6185398, -74.0296877): ['9111 4th Ave ', 2.29], (40.6127518, -73.99608239999999): ['7519 18th Ave ', 2.27], (40.7261022, -73.8977474): ['6615 Borden Ave ', 2.27], (40.8884793, -73.84258659999999): ['1220 E 233rd St ', 2.33], (40.613717, -73.99606): ['1781 Bay Ridge Pkwy ', 2.29], (40.80473, -73.9233074): ['100-102 Bruckner Blvd ', 2.59], (40.8961598, -73.867341): ['285 E 233rd St ', 2.25], (40.87325999999999, -73.854228): ['1128 E Gun Hill Rd ', 2.33], (40.625706, -74.0014252): ['1302 65th  ', 2.27], (40.6847894, -73.85951969999999): ['81-02 Atlantic Ave ', 2.45], (40.679582, -73.880067): ['3123 Atlantic Ave ', 2.23], (40.7968414, -73.9346636): ['2276 1st Ave ', 2.39], (40.592636, -73.9610149): ['2624 Coney Island  ', 2.35], (40.7303, -73.948093): ['278 Greenpoint Ave ', 2.11], (40.6667599, -73.752639): ['224-01 N Conduit Ave ', 2.39], (40.8232109, -73.8786349): ['1500 Bruckner Blvd ', 2.45], (40.8643137, -73.9174139): ['401 W 207th St ', 2.35], (40.849986, -73.7875883): ['400-410 City Island Ave ', 2.39], (40.5927721, -73.9928824): ['2495 Cropsey Ave ', 2.39], (40.63276200000001, -73.966539): ['1041 Coney Island Ave ', 2.39], (40.884662, -73.901245): ['5805 Broadway ', 2.43], (40.8653134, -73.8591788): ['950 Allerton Ave ', 2.35], (40.8949154, -73.8825221): ['71 Major Deegan Expwy ', 2.59], (40.7682469, -73.9696664): ['842 5th Ave ', 2.29], (40.5876666, -73.94953559999999): ['3010 Ocean Ave ', 2.35], (40.7985238, -73.9517339): ['10 Malcolm X Blvd ', 2.13], (40.7618167, -73.8973204): ['2565 Brooklyn Queens Expressway East ', 2.49], (40.6439825, -73.9704702): ['548 Coney Island Ave ', 2.43], (40.7308866, -73.95132749999999): ['256 McGuinness Blvd ', 2.29], (40.7678148, -73.90100369999999): ['49-05 Astoria Blvd N ', 2.39], (40.6964913, -73.9562977): ['801 Bedford Ave ', 2.25], (40.8208861, -73.9382754): ['150 W 145th St ', 2.61], (40.7553735, -73.8903851): ['76-11 Northern Blvd ', 2.53], (40.7588621, -73.93748049999999): ['36-37 21st St ', 2.45], (40.6478464, -73.9147436): ['8914 Ditmas Ave ', 2.39], (40.8665929, -73.8385328): ['1665 Bartow Ave ', 2.29], (40.6144318, -73.92773749999999): ['2285 Flatbush Ave ', 2.23], (40.77942669999999, -73.9065141): ['2001 31st St ', 2.39], (40.6216412, -73.9749966): ['5025 Bay Pkwy ', 2.39], (40.7347683, -73.98609379999999): ['169 3rd Ave ', 2.86], (40.73019960000001, -73.95165899999999): ['210 Greenpoint Ave ', 2.17], (40.61690600000001, -73.9999153): ['7310 New Utrecht Ave ', 2.39], (40.8594744, -73.8673836): ['2290 Boston Rd ', 2.29], (40.7632871, -73.97314829999999): ['745 Fifth Ave ', 2.35], (40.752691, -73.910709): ['50-92 Northern Blvd ', 2.35], (40.6795859, -73.95813629999999): ['1064 Atlantic Ave ', 2.29], (40.6443979, -73.910934): ['972 Remsen Ave ', 2.33], (40.6268712, -73.9416617): ['1760 Flatbush Ave ', 2.27], (40.7000701, -73.9613392): ['713 Kent Ave ', 2.49], (40.8486256, -73.8310882): ['3065 Westchester Ave ', 2.33], (40.8409755, -73.8426226): ['91 Westchester Sq ', 2.33], (40.8351536, -73.9242433): ['1133 Jerome Ave ', 2.29], (40.6773788, -73.9278779): ['1781 Atlantic Ave ', 2.19], (40.582448, -73.834698): ['112-01 Beach Channel Dr ', 2.29], (40.6547991, -73.931124): ['756 Utica  ', 2.29], (40.8075621, -73.9293617): ['119 Bruckner Blvd ', 2.27], (40.6765886, -73.921497): ['1998 Atlantic Ave ', 2.19], (40.8492614, -73.91647689999999): ['1764 University Ave ', 2.33], (40.8515161, -73.8948066): ['495 E 180th St ', 2.29], (40.7286351, -73.9502249): ['176 McGuiness Blvd ', 2.13], (40.8448765, -73.84624819999999): ['1500 Williamsbridge Rd ', 2.33], (40.582987, -73.835201): ['112-10 Beach Channel Dr ', 2.33], (40.622043, -73.987684): ['6002 18th Ave ', 2.29], (40.8652945, -73.86202089999999): ['824 Allerton Ave ', 2.33], (40.6802425, -73.958591): ['1013 Atlantic  ', 2.29], (40.6560743, -73.94748799999999): ['720 New York Ave ', 2.39], (40.677858, -73.98317999999999): ['204-222 Fourth Ave ', 2.25], (40.8174926, -73.956356): ['3260 Broadway  ', 2.39], (40.5968616, -73.9505824): ['2001 Gravesend Neck Rd ', 2.45], (40.836564, -73.870655): ['1719 Cross Bronx Expy N ', 2.43], (40.7624381, -73.9570024): ['805 65th St ', 2.39], (40.8957637, -73.87643969999999): ['1 East 233rd St ', 2.35], (40.6770742, -73.8968713): ['2642 Fulton St ', 2.25], (40.7132879, -73.9776201): ['1049 Grand St ', 2.39], (40.6772339, -73.8986783): ['32 Jamaica Ave ', 2.29], (40.6881907, -73.8756468): ['784 Jamaica Ave ', 2.27], (40.6795807, -73.8779243): ['3170 Atlantic Ave ', 2.17], (40.7173557, -73.81745169999999): ['141-50 Union Tpke  ', 2.33], (40.7898331, -73.9405791): ['348 E 106th St ', 2.35], (40.8075298, -73.9376199): ['1890 Park Ave ', 2.33], (40.6011989, -73.9344783): ['2228 Gerritsen Ave ', 2.25], (40.67791649999999, -73.9438971): ['1450 Atlantic Ave ', 2.21], (40.845049, -73.93858999999999): ['4116 Broadway ', 2.43], (40.657191, -74.000889): ['833 4th Ave ', 2.27], (40.8599194, -73.9026122): [' 2350 Jerome Ave ', 2.33], (40.76486999999999, -73.883909): ['85-05 Astoria Blvd ', 2.35], (40.6472259, -73.98086049999999): ['28 Caton  ', 2.33], (40.6273057, -73.96591459999999): ['1248 Coney Island Ave ', 2.39], (40.751147, -73.974256): ['668 3rd Ave ', 2.25], (40.882357, -73.8265322): ['2280 Tillotson Ave ', 2.27], (40.5803553, -73.9858725): ['3072 Cropsey Ave ', 2.25], (40.89582600000001, -73.86362): ['4201 Webster Ave ', 2.35], (40.6803333, -73.8406083): ['98-21 Rockaway Blvd ', 2.29], (40.8795545, -73.83722569999999): ['3400-08 Baychester Ave ', 2.29], (40.6483375, -73.90566319999999): ['9702 Foster Ave  ', 2.37], (40.7027649, -73.8548687): ['9005 Myrtle Ave ', 2.45], (40.6454988, -73.98536849999999): ['3437 Ft Hamilton Pkwy ', 2.31], (40.8713659, -73.8639902): ['780 Burke Ave ', 2.39], (40.7617081, -73.8681658): ['101-06 Astoria Blvd ', 2.33], (40.6730189, -73.87168): ['1249 Sutter Ave ', 2.25], (40.6478184, -73.97160389999999): ['418 Coney Island Ave ', 2.45], (40.6395011, -73.95440839999999): ['1267 Flatbush Ave   ', 2.24], (40.7076887, -73.950845): ['239 Union Ave ', 2.39], (40.6807235, -73.9617289): ['941 Atlantic Ave ', 2.29], (40.856941, -73.88163999999999): ['730 E Fordham Rd ', 2.53], (40.639255, -74.0230155): ['301 65th  ', 2.29], (40.71460260000001, -73.9422105): ['2 Bushwick Ave ', 2.25], (40.60898299999999, -73.973787): ['2516 65th St ', 2.37], (40.6730638, -73.9988774): ['375 Hamilton Ave ', 2.49], (40.5925173, -73.90819139999999): ['6000 Shore Pkwy ', 2.59], (40.8680518, -73.85885569999999): ['2918 Boston Rd ', 2.29], (40.8615796, -73.91241029999999): ['296 W Fordham Rd ', 2.39], (40.8500841, -73.8641664): ['1982 Bronxdale Ave ', 2.39], (40.80525, -73.9347313): ['4058 3rd Ave ', 2.33], (40.884991, -73.826518): ['3500 Conner St ', 2.35], (40.6303489, -73.94543709999999): ['1640 Flatbush Ave ', 2.29], (40.88549330000001, -73.8280461): ['4090 Boston Rd ', 2.29], (40.7797904, -73.9443915): ['579 92nd St ', 2.45], (40.826602, -73.859073): ['1915 Bruckner Blvd ', 2.49], (40.6801719, -73.8392721): ['100-07 Rockaway Blvd ', 2.29], (40.8349887, -73.830105): ['3333 E Tremont Ave ', 2.33], (40.6765117, -73.9093378): ['2111 Atlantic Ave ', 2.37], (40.6614537, -73.9610021): ['513 Flatbush Ave ', 2.29], (40.8138298, -73.9306617): ['115 E 138th St ', 2.45], (40.7016427, -73.93712099999999): ['864 Flushing Ave ', 2.43], (40.8367838, -73.92705959999999): ['1165 Ogden Ave ', 2.17], (40.8203004, -73.9266353): ['611 Grand Concourse ', 2.31], (40.8583781, -73.88552109999999): ['590 E Fordham Rd ', 2.27], (40.654226, -73.90715469999999): ['1022 Rockaway Ave ', 2.27], (40.8466909, -73.9019081): ['1845 Webster Ave ', 2.41], (40.8502094, -73.8371051): ['1325 Hutchinson River Pkwy S ', 3.59], (40.7663445, -73.9940505): ['718 11th Ave ', 3.99], (40.679269, -73.89942669999999): ['32 Highland Blvd ', 2.29], (40.6975358, -73.9693733): ['168 Flushing Ave ', 2.39], (40.8072502, -73.9238593): ['164 Willis Ave ', 2.69], (40.8218906, -73.9405752): ['232 W 145th St ', 2.27], (40.631525, -74.002456): ['1105 60th St ', 2.29], (40.8482409, -73.88360080000001): ['820 E 182nd St ', 2.33], (40.7415548, -73.9723541): ['FDR Dr  ', 2.89], (40.8392619, -73.9373512): ['2165 Amsterdam Ave ', 2.35], (40.62329039999999, -73.9276971): ['1982 Utica Ave ', 2.37], (40.8157268, -73.92831369999999): ['350 Grand Concourse ', 2.29], (40.7374927, -73.74182019999999): ['108-01 Grand Central Pkwy W  ', 2.53], (40.7699117, -73.9025442): ['4606 Ditmars Blvd ', 2.35], (40.6329769, -74.0125429): ['6418 8th Ave ', 2.39], (40.8691366, -73.9072685): ['2590 Bailey Ave ', 2.39], (40.6771699, -73.9300293): ['1802 Atlantic Ave ', 2.27], (40.83686549999999, -73.92161399999999): ['1237 Jerome Ave ', 2.33], (40.7343687, -73.98991269999999): ['164 4th Ave ', 2.29], (40.5943506, -73.93332509999999): ['2402 Knapp St ', 2.35], (40.608699, -74.0056984): ['1672 86th St ', 2.49], (40.6141179, -73.9633741): ['1780 Coney Island Ave ', 2.39], (40.80497099999999, -73.912306): ['250 Jackson Ave ', 2.31], (40.6771623, -73.93274389999999): ['1740 Atlantic Ave ', 2.23], (40.60637699999999, -73.987436): ['1626 Stillwell Ave ', 2.39], (40.8704356, -73.9147205): ['5080 Broadway ', 2.39], (40.8172955, -73.8934649): ['126 Bruckner Blvd ', 2.29], (40.6522291, -73.9223793): ['5824 Church Ave ', 2.19], (40.6122293, -74.0115112): ['1420 86th St ', 2.49], (40.90766929999999, -73.8968242): ['6571 Broadway ', 2.35], (40.6561408, -74.00201369999999): ['875 4th Ave ', 2.39], (40.5945081, -73.78942339999999): ['59-14 Beach Channel Dr ', 2.27], (40.88553599999999, -73.9000712): ['5832 Broadway ', 2.67], (40.71267410000001, -73.9051532): ['60-04 Metropolitan Ave ', 2.29], (40.7830906, -73.9452024): ['1855 1st Ave ', 2.33], (40.6368129, -73.936048): ['4210 Farragut Rd ', 2.31], (40.888745, -73.841551): ['1225 E 233rd St ', 2.49], (40.7206819, -73.944379): ['497 Meeker Ave ', 2.19], (40.6380468, -73.9793267): ['1 Cortelyou Rd ', 2.35], (40.7146911, -73.9415973): ['810 Metropolitan Ave ', 2.25], (40.7002436, -73.9475598): ['655 Flushing Ave ', 2.29], (40.870828, -73.877977): ['3079-3087 Webster Ave ', 2.45], (40.6528025, -73.8868997): ['1130 Pennsylvania  Ave ', 2.23], (40.679827, -73.877043): ['3196 Atlantic Ave ', 2.19], (40.6761461, -73.8679717): ['586 S Conduit Blvd ', 2.37], (40.6399524, -73.98302799999999): ['3715 14th Ave  ', 2.29], (40.6014868, -74.00478389999999): ['1907 Cropsey Ave ', 2.39], (40.6227826, -73.9865202): ['5818 18th Ave ', 2.35], (40.6634448, -73.9541796): ['250 Empire Blvd ', 2.29], (40.8414943, -73.9275881): ['1314 Sedgwick Ave ', 2.17], (40.7584157, -73.9688887): ['899 3rd Ave ', 2.29], (40.8703011, -73.87882119999999): ['3059 Webster Ave ', 2.51], (40.7624133, -73.9570207): ['802 65th St ', 2.29], (40.6587085, -73.891305): ['1935 Linden Blvd ', 2.35], (40.6141277, -73.9628424): ['1775 Coney Island Ave ', 2.35], (40.891866, -73.853347): ['836 East 233rd St ', 2.37], (40.6186288, -74.0208329): ['8521 7th Ave ', 2.29]}



  #Function to return nearest gas stations + their prices
  def get_nearest(new_location):
    lowest = 99999999
    for station in ny_stations:
        dist_lat = new_location[0] - station[0]
        dist_lng = new_location[1] - station[1]
        if lowest > (dist_lat**2 + dist_lng**2)**.5:
            lowest = (dist_lat**2 + dist_lng**2)**.5
            lat_long= station
    ny_station_ll = ny_stations[lat_long]
    cost = ny_stations[lat_long]
        
    # Getting directions from your current location to a new latitude/longitude
    c = Client(key='AIzaSyBOkcsB4FSHYoz6CorB32hOv9qUOWPfcvw')
    steps = c.directions(new_location, (lat_long))[0]['legs'][0]['steps']

    # Printing out step by step driver instructions
    gas = []

    for d in steps:
        gas.append(d['html_instructions'])
    return [gas, ny_station_ll, cost]

  gas = get_nearest(tuple(current_latlng))
  latlong = requests.get('https://maps.googleapis.com/maps/api/geocode/json?address=' + my_location.get_current()[0] + ',' + my_location.get_current()[1] + '&key=AIzaSyBOkcsB4FSHYoz6CorB32hOv9qUOWPfcvw')
  current_loc = latlong.json()['results'][0]['formatted_address']

  
  user = {'gas': gas[0], 'current':current_loc, 'current_latlong': current_latlng, 'cost': gas[2][1], 'station': gas[2][0]}
  form = LoginForm()
  if form.validate_on_submit():
    return redirect('/index')
  return render_template('gas.html',
                         title='Home',
                         form = form,
                         user=user)










